<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>#freeholyC Chat</title>
<style>
  body { margin:0; font-family:sans-serif; overflow:hidden; background:#111; color:#fff; }
  #freeholyC { position:absolute; font-size:2rem; font-weight:bold; color:#0f0; pointer-events:none; }
  .ad { position:absolute; top:50%; transform:translateY(-50%); width:120px; }
  .ad.left { left:0; }
  .ad.right { right:0; }
  .chat-container { position:absolute; top:0; left:150px; right:150px; bottom:0; display:flex; flex-direction:column; background:rgba(0,0,0,0.6); }
  .messages { flex:1; overflow-y:auto; padding:10px; }
  .controls { display:flex; padding:5px; gap:5px; }
  input[type="text"] { flex:1; }
  .msg { margin-bottom:10px; }
  .msg .meta { font-size:0.8em; color:#aaa; }
  img, video { max-width:300px; max-height:200px; display:block; margin-top:5px; }
</style>
</head>
<body>

<!-- Ads -->
<img class="ad left" src="https://i.imgur.com/aC2gfh8.jpeg" alt="left ad">
<img class="ad right" src="https://i.imgur.com/aC2gfh8.jpeg" alt="right ad">

<!-- flying #freeholyC -->
<div id="freeholyC">#freeholyC</div>

<!-- Chat -->
<div class="chat-container">
  <div class="messages" id="messages"></div>
  <div class="controls">
    <input id="nameInput" type="text" placeholder="Your name">
    <input id="textInput" type="text" placeholder="Type a message">
    <input id="fileInput" type="file" accept="image/*,video/*">
    <button id="sendBtn">Send</button>
  </div>
</div>

<script type="module">
import Gun from 'https://cdn.jsdelivr.net/npm/gun/gun.mjs';

interface ChatMessage {
  id: string;
  name: string;
  text: string;
  ts: string;
  media: boolean;
  contentType?: string;
}

const gun = Gun();
const messages = gun.get('messages');

const messagesEl = document.getElementById('messages') as HTMLDivElement;
const textInput = document.getElementById('textInput') as HTMLInputElement;
const nameInput = document.getElementById('nameInput') as HTMLInputElement;
const fileInput = document.getElementById('fileInput') as HTMLInputElement;
const sendBtn = document.getElementById('sendBtn') as HTMLButtonElement;

function appendMessageToDOM(msg: ChatMessage) {
  const el = document.createElement('div');
  el.className = 'msg';
  const meta = document.createElement('div');
  meta.className = 'meta';
  meta.textContent = `${msg.name} â€¢ ${new Date(msg.ts).toLocaleTimeString()}`;
  const body = document.createElement('div');
  if(msg.media && msg.contentType){
    if(msg.contentType.startsWith('image')){
      const img = document.createElement('img'); img.src = msg.text; body.appendChild(img);
    } else if(msg.contentType.startsWith('video')){
      const video = document.createElement('video'); video.src = msg.text; video.controls = true; body.appendChild(video);
    }
  } else { body.textContent = msg.text; }
  el.appendChild(meta); el.appendChild(body);
  messagesEl.appendChild(el);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

// Gun.js listener
messages.map().on((msg: ChatMessage) => { if(msg) appendMessageToDOM(msg); });

// Send text message
function sendMessageHandler() {
  const text = textInput.value.trim();
  if(!text) return;
  const msg: ChatMessage = {
    id: Gun.text.random(),
    name: nameInput.value || 'anon',
    text,
    ts: new Date().toISOString(),
    media:false
  };
  messages.set(msg);
  textInput.value='';
}

// Send media
fileInput.addEventListener('change', ()=>{
  const file = fileInput.files?.[0];
  if(!file) return;
  if(file.size>1024*1024*100){ alert("Max 100MB!"); return; }
  const reader = new FileReader();
  reader.onload = e=>{
    const base64 = e.target?.result as string;
    const msg: ChatMessage = {
      id: Gun.text.random(),
      name: nameInput.value||'anon',
      text: base64,
      ts:new Date().toISOString(),
      media:true,
      contentType:file.type
    };
    messages.set(msg);
  };
  reader.readAsDataURL(file);
});

sendBtn.addEventListener('click', sendMessageHandler);
textInput.addEventListener('keydown', e=>{if(e.key==='Enter') sendMessageHandler();});

// Flying #freeholyC like DVD logo
const freeholyC = document.getElementById('freeholyC')!;
let x = Math.random()*window.innerWidth/2, y = Math.random()*window.innerHeight/2;
let vx = 2 + Math.random()*3, vy = 2 + Math.random()*3;

function animate() {
  const rect = freeholyC.getBoundingClientRect();
  x += vx; y += vy;
  if(x<0 || x+rect.width>window.innerWidth){ vx*=-1; freeholyC.style.color=`#${Math.floor(Math.random()*0xFFFFFF).toString(16)}`; }
  if(y<0 || y+rect.height>window.innerHeight){ vy*=-1; freeholyC.style.color=`#${Math.floor(Math.random()*0xFFFFFF).toString(16)}`; }
  freeholyC.style.left=x+'px';
  freeholyC.style.top=y+'px';
  freeholyC.style.transform=`rotate(${Date.now()%360}deg)`; // spinning
  requestAnimationFrame(animate);
}
animate();

</script>
</body>
</html>
